<%- include('../partials/header') %>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2>
                <i class="bi bi-file-text me-2"></i>Request Details
            </h2>
            <% if (typeof order !== 'undefined' && order) { %>
                <p class="text-muted mb-0">Request #<%= order.id %></p>
            <% } %>
        </div>
        <div>
            <a href="/admin/requests" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>Back to Requests
            </a>
        </div>
    </div>

    <div class="row g-4">
        <!-- Request Information -->
        <div class="col-lg-8">
            <% if (typeof order !== 'undefined' && order) { %>
                <!-- Customer Information -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-person me-2"></i>Customer Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <h6 class="text-muted">Name</h6>
                                <p class="mb-3"><%= order.name %></p>
                                
                                <h6 class="text-muted">Phone</h6>
                                <p class="mb-3">
                                    <a href="tel:<%= order.phone %>" class="text-decoration-none">
                                        <%= order.phone %>
                                    </a>
                                </p>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-muted">Address</h6>
                                <p class="mb-3"><%= order.address || 'Not provided' %></p>
                                
                                <h6 class="text-muted">Request Date</h6>
                                <p class="mb-3">
                                    <%= order.created_at ? new Date(order.created_at).toLocaleDateString() : 'N/A' %>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Request Details -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-info-circle me-2"></i>Request Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <h6 class="text-muted">Items Description</h6>
                                <p class="mb-3"><%= order.items %></p>
                                
                                <h6 class="text-muted">Status</h6>
                                <p class="mb-3">
                                    <span class="badge bg-<%= order.status === 'pending' ? 'warning' : order.status === 'done' ? 'success' : 'info' %>">
                                        <%= order.status %>
                                    </span>
                                </p>
                            </div>
                            <div class="col-md-6">
                                <% if (order.attachment) { %>
                                    <h6 class="text-muted">Attachment</h6>
                                    <p class="mb-3">
                                        <a href="/<%= order.attachment %>" target="_blank" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-paperclip me-1"></i>View File
                                        </a>
                                    </p>
                                <% } %>
                                
                                <h6 class="text-muted">Last Updated</h6>
                                <p class="mb-3">
                                    <%= order.updated_at ? new Date(order.updated_at).toLocaleDateString() : 'N/A' %>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            <% } else { %>
                <div class="card">
                    <div class="card-body text-center py-5">
                        <i class="bi bi-exclamation-triangle text-muted" style="font-size: 4rem;"></i>
                        <h4 class="text-muted mt-3">Request not found</h4>
                        <p class="text-muted">The requested order could not be found.</p>
                        <a href="/admin/requests" class="btn btn-primary">
                            <i class="bi bi-arrow-left me-2"></i>Back to Requests
                        </a>
                    </div>
                </div>
            <% } %>
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <% if (typeof order !== 'undefined' && order) { %>
                <!-- Quick Actions -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-lightning me-2"></i>Quick Actions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <form method="POST" action="/admin/order/<%= order.id %>/status" class="mb-2">
                                <div class="input-group">
                                    <select name="status" class="form-select">
                                        <option value="pending" <%= order.status === 'pending' ? 'selected' : '' %>>Pending</option>
                                        <option value="in_progress" <%= order.status === 'in_progress' ? 'selected' : '' %>>In Progress</option>
                                        <option value="done" <%= order.status === 'done' ? 'selected' : '' %>>Done</option>
                                    </select>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-check"></i> Update
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Status Timeline -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-clock-history me-2"></i>Status Timeline
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="timeline">
                            <div class="timeline-item active">
                                <div class="timeline-marker bg-success"></div>
                                <div class="timeline-content">
                                    <h6>Request Submitted</h6>
                                    <small class="text-muted">Request has been received</small>
                                </div>
                            </div>
                            
                            <% if (order.status !== 'pending') { %>
                                <div class="timeline-item active">
                                    <div class="timeline-marker bg-info"></div>
                                    <div class="timeline-content">
                                        <h6>Processing</h6>
                                        <small class="text-muted">Request is being processed</small>
                                    </div>
                                </div>
                            <% } else { %>
                                <div class="timeline-item">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <h6>Processing</h6>
                                        <small class="text-muted">Waiting to be processed</small>
                                    </div>
                                </div>
                            <% } %>
                            
                            <% if (order.status === 'done') { %>
                                <div class="timeline-item active">
                                    <div class="timeline-marker bg-success"></div>
                                    <div class="timeline-content">
                                        <h6>Completed</h6>
                                        <small class="text-muted">Order is ready</small>
                                    </div>
                                </div>
                            <% } else { %>
                                <div class="timeline-item">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <h6>Completed</h6>
                                        <small class="text-muted">Pending completion</small>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            <% } %>
        </div>
    </div>
</div>

<style>
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline-item {
    position: relative;
    margin-bottom: 20px;
}

.timeline-item:before {
    content: '';
    position: absolute;
    left: -22px;
    top: 20px;
    bottom: -20px;
    width: 2px;
    background: #dee2e6;
}

.timeline-item:last-child:before {
    display: none;
}

.timeline-marker {
    position: absolute;
    left: -30px;
    top: 0;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #dee2e6;
    border: 3px solid #fff;
    box-shadow: 0 0 0 2px #dee2e6;
}

.timeline-item.active .timeline-marker {
    box-shadow: 0 0 0 2px #28a745;
}

.timeline-content h6 {
    margin-bottom: 5px;
    font-size: 14px;
}

.timeline-content small {
    font-size: 12px;
}
</style>

<%- include('../partials/footer') %>